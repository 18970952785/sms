<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.malicn.server.dao.cmsorder.CmsOrderInfoDao" >
  <resultMap id="OrderInfoMap" type="com.malicn.server.domain.cmsorder.CmsOrderInfo" >
    <id column="order_id" property="orderId" jdbcType="BIGINT" />
    <result column="start_name" property="startName" jdbcType="VARCHAR" />
    <result column="start_address" property="startAddress" jdbcType="VARCHAR" />
    <result column="arrive_name" property="arriveName" jdbcType="VARCHAR" />
    <result column="arrive_address" property="arriveAddress" jdbcType="VARCHAR" />
    <result column="weight" property="weight" jdbcType="DECIMAL" />
    <result column="flow_control_pics" property="flowControlPics" jdbcType="VARCHAR" />
    <result column="driver_name" property="driverName" jdbcType="VARCHAR" />
    <result column="driver_mobile" property="driverMobile" jdbcType="VARCHAR" />
    <result column="plate_no" property="plateNo" jdbcType="VARCHAR" />
    <result column="driver_img" property="driverImg" jdbcType="VARCHAR" />
    <result column="vehicle_img" property="vehicleImg" jdbcType="VARCHAR" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="end_time" property="endTime" jdbcType="TIMESTAMP" />

  </resultMap>

  <sql id="AllColumn">
    order_id,start_name,start_address,arrive_name,arrive_address,weight,
    flow_control_pics,driver_name,
    driver_mobile,plate_no,driver_img,vehicle_img,create_time,end_time
  </sql>

  <select id="getOrderInfoGroupByMonths" resultType="String">
    select DATE_FORMAT(create_time,'%Y.%m') months from cms_order_info group by months  ORDER BY months DESC
  </select>

  <!-- 根据订单号查询订单信息 -->
  <select id="getOrderInfoByOrderId" parameterType="java.lang.Long" resultMap="OrderInfoMap">
    select  <include refid="AllColumn" />
    from cms_order_info where  order_id= #{orderId}
  </select>

  <!-- 查询订单列表 -->
  <select id="getListOrderInfo" resultMap="OrderInfoMap">
    select DISTINCT a.order_id,start_name,start_address,arrive_name,arrive_address,weight,create_time,end_time FROM cms_order_info a
    LEFT JOIN cms_order_details b on a.order_id = b.order_id
    where LOCATE(#{productName},b.product_name) > 0
    <if test="date != null">
      and to_days(create_time) =  to_days(#{date})
    </if>
    order by create_time Desc
  </select>
</mapper>