<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.malicn.server.dao.cloudStorage.CloudStorageDao">
    <resultMap id="BaseResultMap" type="com.malicn.server.domain.cloudStorage.CloudStorage">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="company_name" property="companyName" jdbcType="VARCHAR"/>
        <result column="storage_name" property="storageName" jdbcType="VARCHAR"/>
        <result column="city_id" property="cityId" jdbcType="INTEGER"/>
        <result column="city_name" property="cityName" jdbcType="VARCHAR"/>
        <result column="storage_create_time" property="storageCreateTime" jdbcType="TIMESTAMP"/>
        <result column="storage_address" property="storageAddress" jdbcType="VARCHAR"/>
        <result column="billing_mode" property="billingMode" jdbcType="TINYINT"/>
        <result column="ref_price_min" property="refPriceMin" jdbcType="DECIMAL"/>
        <result column="ref_price_max" property="refPriceMax" jdbcType="DECIMAL"/>
        <result column="applicant" property="applicant" jdbcType="VARCHAR"/>
        <result column="applicant_contact" property="applicantContact" jdbcType="VARCHAR"/>
        <result column="applicant_con_tel" property="applicantConTel" jdbcType="VARCHAR"/>
        <result column="traffic_setting" property="trafficSetting" jdbcType="TINYINT"/>
        <result column="traffic_distance" property="trafficDistance" jdbcType="TINYINT"/>
        <result column="main_entr_width" property="mainEntrWidth" jdbcType="TINYINT"/>
        <result column="aisle_width" property="aisleWidth" jdbcType="TINYINT"/>
        <result column="park_wall" property="parkWall" jdbcType="TINYINT"/>
        <result column="is_access_con" property="isAccessCon" jdbcType="TINYINT"/>
        <result column="ad_price" property="adPrice" jdbcType="DECIMAL"/>
        <result column="security_term" property="securityTerm" jdbcType="VARCHAR"/>
        <result column="is_workspace" property="isWorkspace" jdbcType="TINYINT"/>
        <result column="is_frozen_market" property="isFrozenMarket" jdbcType="TINYINT"/>
        <result column="edifice_type" property="edificeType" jdbcType="TINYINT"/>
        <result column="storage_func" property="storageFunc" jdbcType="VARCHAR"/>
        <result column="storage_temp" property="storageTemp" jdbcType="TINYINT"/>
        <result column="cryogen_mode" property="cryogenMode" jdbcType="TINYINT"/>
        <result column="storage_capacity" property="storageCapacity" jdbcType="DECIMAL"/>
        <result column="con_area" property="conArea" jdbcType="DECIMAL"/>
        <result column="high_level" property="highLevel" jdbcType="TINYINT"/>
        <result column="storage_high" property="storageHigh" jdbcType="TINYINT"/>
        <result column="platform" property="platform" jdbcType="TINYINT"/>
        <result column="site_width" property="siteWidth" jdbcType="TINYINT"/>
        <result column="parking" property="parking" jdbcType="TINYINT"/>
        <result column="hole_count" property="holeCount" jdbcType="INTEGER"/>
        <result column="is_charge_pillar" property="isChargePillar" jdbcType="TINYINT"/>
        <result column="charge_count" property="chargeCount" jdbcType="INTEGER"/>
        <result column="is_fire_filing" property="isFireFiling" jdbcType="TINYINT"/>
        <result column="fire_system" property="fireSystem" jdbcType="VARCHAR"/>
        <result column="property_manage" property="propertyManage" jdbcType="TINYINT"/>
        <result column="storage_com_name" property="storageComName" jdbcType="VARCHAR"/>
        <!--2018年1月3日 zdd 新增需求新增字段-->
        <result column="loading_fee" property="loadingFee" jdbcType="DECIMAL"/>
        <result column="scan_code_fee" property="scanCodeFee" jdbcType="DECIMAL"/>
        <result column="color_sep_fee" property="colorSepFee" jdbcType="DECIMAL"/>
        <result column="manage_fee" property="manageFee" jdbcType="VARCHAR"/>

        <result column="is_auth" property="isAuth" jdbcType="TINYINT"/>
        <result column="is_deleted" property="isDeleted" jdbcType="TINYINT"/>
        <result column="creator" property="creator" jdbcType="INTEGER"/>
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="updator" property="updator" jdbcType="INTEGER"/>
        <result column="update_time" property="updateTime" jdbcType="TIMESTAMP"/>
        <!-- 正面照片 -->
        <result column="front_img" property="frontImg"/>
    </resultMap>
    <sql id="Base_Column_List">
    id, company_name, storage_name, city_id, city_name, storage_create_time, storage_address, 
    billing_mode, ref_price_min, ref_price_max, applicant, applicant_contact, applicant_con_tel, 
    traffic_setting, traffic_distance, main_entr_width, aisle_width, park_wall, is_access_con, 
    ad_price,  security_term, is_workspace, is_frozen_market,
    edifice_type, storage_func, storage_temp, cryogen_mode, storage_capacity, con_area, 
    high_level, storage_high, platform, site_width, parking, hole_count, is_charge_pillar, 
    charge_count, is_fire_filing, fire_system, property_manage, storage_com_name
    ,loading_fee,scan_code_fee,color_sep_fee,manage_fee,is_auth,
    is_deleted, creator, create_time, updator, update_time
  </sql>
    <!-- 云仓首页列表 -->
    <select id="listStorage" resultMap="BaseResultMap">
        SELECT
        a.id, a.storage_name, a.city_name, a.storage_address,
        a.ref_price_min, a.ref_price_max, a.con_area, a.billing_mode, edifice_type,
        a.storage_func, a.is_auth, (select file_url from yc_storage_file where storage_id = a.id and file_class = 5) as
        front_img
        FROM yc_storage a
        WHERE a.is_deleted = 0
        <choose>
            <when test="cityId != null and cityId != 0">
                AND a.city_id = #{cityId}
            </when>
            <otherwise>
                <if test="provinceId != null and provinceId != 0">
                    AND a.city_id in (select id from ml_region where parent_id = #{provinceId})
                </if>
            </otherwise>
        </choose>
        ORDER BY a.is_auth DESC,a.create_time DESC
    </select>


    <select id="selectByPrimaryKey" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from yc_storage
        where is_deleted=0
        <if test="cityId !=null and cityId !=''">
            and city_id=#{cityId}
        </if>
        <if test="storageName !=null and storageName !=''">
            and storage_name like concat('%',#{storageName},'%')
        </if>
        order by update_time Desc
    </select>


    <select id="getById" resultMap="BaseResultMap" parameterType="java.lang.Long">
        select
        <include refid="Base_Column_List"/>
        from yc_storage
        where id = #{id,jdbcType=BIGINT} AND is_deleted=0
    </select>


    <insert id="insertCloudStorage" useGeneratedKeys="true" keyProperty="id"
            parameterType="com.malicn.server.domain.cloudStorage.CloudStorage">
        insert into yc_storage
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>
            <if test="companyName != null">
                company_name,
            </if>
            <if test="storageName != null">
                storage_name,
            </if>
            <if test="cityId != null">
                city_id,
            </if>
            <if test="cityName != null">
                city_name,
            </if>
            <if test="storageCreateTime != null">
                storage_create_time,
            </if>
            <if test="storageAddress != null">
                storage_address,
            </if>
            <if test="billingMode != null">
                billing_mode,
            </if>
            <if test="refPriceMin != null">
                ref_price_min,
            </if>
            <if test="refPriceMax != null">
                ref_price_max,
            </if>
            <if test="applicant != null">
                applicant,
            </if>
            <if test="applicantContact != null">
                applicant_contact,
            </if>
            <if test="applicantConTel != null">
                applicant_con_tel,
            </if>
            <if test="trafficSetting != null">
                traffic_setting,
            </if>
            <if test="trafficDistance != null">
                traffic_distance,
            </if>
            <if test="mainEntrWidth != null">
                main_entr_width,
            </if>
            <if test="aisleWidth != null">
                aisle_width,
            </if>
            <if test="parkWall != null">
                park_wall,
            </if>
            <if test="isAccessCon != null">
                is_access_con,
            </if>
            <if test="adPrice != null">
                ad_price,
            </if>

            <if test="securityTerm != null">
                security_term,
            </if>
            <if test="isWorkspace != null">
                is_workspace,
            </if>
            <if test="isFrozenMarket != null">
                is_frozen_market,
            </if>
            <if test="edificeType != null">
                edifice_type,
            </if>
            <if test="storageFunc != null">
                storage_func,
            </if>
            <if test="storageTemp != null">
                storage_temp,
            </if>
            <if test="cryogenMode != null">
                cryogen_mode,
            </if>
            <if test="storageCapacity != null">
                storage_capacity,
            </if>
            <if test="conArea != null">
                con_area,
            </if>
            <if test="highLevel != null">
                high_level,
            </if>
            <if test="storageHigh != null">
                storage_high,
            </if>
            <if test="platform != null">
                platform,
            </if>
            <if test="siteWidth != null">
                site_width,
            </if>
            <if test="parking != null">
                parking,
            </if>
            <if test="holeCount != null">
                hole_count,
            </if>
            <if test="isChargePillar != null">
                is_charge_pillar,
            </if>
            <if test="chargeCount != null">
                charge_count,
            </if>
            <if test="isFireFiling != null">
                is_fire_filing,
            </if>
            <if test="fireSystem != null">
                fire_system,
            </if>
            <if test="propertyManage != null">
                property_manage,
            </if>
            <if test="storageComName != null">
                storage_com_name,
            </if>

            <if test="loadingFee != null">
                loading_fee,
            </if>

            <if test="scanCodeFee != null">
                scan_code_fee,
            </if>
            <if test="colorSepFee != null">
                color_sep_fee,
            </if>
            <if test="manageFee != null">
                manage_fee,
            </if>

            <if test="isAuth != null">
                is_auth,
            </if>
            <if test="isDeleted != null">
                is_deleted,
            </if>
            <if test="creator != null">
                creator,
            </if>
            create_time,
            <if test="updator != null">
                updator,
            </if>

        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=BIGINT},
            </if>
            <if test="companyName != null">
                #{companyName,jdbcType=VARCHAR},
            </if>
            <if test="storageName != null">
                #{storageName,jdbcType=VARCHAR},
            </if>
            <if test="cityId != null">
                #{cityId,jdbcType=INTEGER},
            </if>
            <if test="cityName != null">
                #{cityName,jdbcType=VARCHAR},
            </if>
            <if test="storageCreateTime != null">
                #{storageCreateTime,jdbcType=TIMESTAMP},
            </if>
            <if test="storageAddress != null">
                #{storageAddress,jdbcType=VARCHAR},
            </if>
            <if test="billingMode != null">
                #{billingMode,jdbcType=TINYINT},
            </if>
            <if test="refPriceMin != null">
                #{refPriceMin,jdbcType=DECIMAL},
            </if>
            <if test="refPriceMax != null">
                #{refPriceMax,jdbcType=DECIMAL},
            </if>
            <if test="applicant != null">
                #{applicant,jdbcType=VARCHAR},
            </if>
            <if test="applicantContact != null">
                #{applicantContact,jdbcType=VARCHAR},
            </if>
            <if test="applicantConTel != null">
                #{applicantConTel,jdbcType=VARCHAR},
            </if>
            <if test="trafficSetting != null">
                #{trafficSetting,jdbcType=TINYINT},
            </if>
            <if test="trafficDistance != null">
                #{trafficDistance,jdbcType=TINYINT},
            </if>
            <if test="mainEntrWidth != null">
                #{mainEntrWidth,jdbcType=TINYINT},
            </if>
            <if test="aisleWidth != null">
                #{aisleWidth,jdbcType=TINYINT},
            </if>
            <if test="parkWall != null">
                #{parkWall,jdbcType=TINYINT},
            </if>
            <if test="isAccessCon != null">
                #{isAccessCon,jdbcType=TINYINT},
            </if>
            <if test="adPrice != null">
                #{adPrice,jdbcType=DECIMAL},
            </if>
            <if test="securityTerm != null">
                #{securityTerm,jdbcType=VARCHAR},
            </if>
            <if test="isWorkspace != null">
                #{isWorkspace,jdbcType=TINYINT},
            </if>
            <if test="isFrozenMarket != null">
                #{isFrozenMarket,jdbcType=TINYINT},
            </if>
            <if test="edificeType != null">
                #{edificeType,jdbcType=TINYINT},
            </if>
            <if test="storageFunc != null">
                #{storageFunc,jdbcType=VARCHAR},
            </if>
            <if test="storageTemp != null">
                #{storageTemp,jdbcType=TINYINT},
            </if>
            <if test="cryogenMode != null">
                #{cryogenMode,jdbcType=TINYINT},
            </if>
            <if test="storageCapacity != null">
                #{storageCapacity,jdbcType=DECIMAL},
            </if>
            <if test="conArea != null">
                #{conArea,jdbcType=DECIMAL},
            </if>
            <if test="highLevel != null">
                #{highLevel,jdbcType=TINYINT},
            </if>
            <if test="storageHigh != null">
                #{storageHigh,jdbcType=TINYINT},
            </if>
            <if test="platform != null">
                #{platform,jdbcType=TINYINT},
            </if>
            <if test="siteWidth != null">
                #{siteWidth,jdbcType=TINYINT},
            </if>
            <if test="parking != null">
                #{parking,jdbcType=TINYINT},
            </if>
            <if test="holeCount != null">
                #{holeCount,jdbcType=INTEGER},
            </if>
            <if test="isChargePillar != null">
                #{isChargePillar,jdbcType=TINYINT},
            </if>
            <if test="chargeCount != null">
                #{chargeCount,jdbcType=INTEGER},
            </if>
            <if test="isFireFiling != null">
                #{isFireFiling,jdbcType=TINYINT},
            </if>
            <if test="fireSystem != null">
                #{fireSystem,jdbcType=VARCHAR},
            </if>
            <if test="propertyManage != null">
                #{propertyManage,jdbcType=TINYINT},
            </if>
            <if test="storageComName != null">
                #{storageComName,jdbcType=VARCHAR},
            </if>

           -- 2018年1月3日14:02:16 曾丁丁
            <if test="loadingFee != null">
                #{loadingFee,jdbcType=DECIMAL},
            </if>

            <if test="scanCodeFee != null">
                #{scanCodeFee,jdbcType=DECIMAL},
            </if>
            <if test="colorSepFee != null">
                #{colorSepFee,jdbcType=DECIMAL},
            </if>
            <if test="manageFee != null">
                #{manageFee,jdbcType=VARCHAR},
            </if>
            <if test="isAuth != null">
                #{isAuth,jdbcType=TINYINT},
            </if>
            <if test="isDeleted != null">
                #{isDeleted,jdbcType=TINYINT},
            </if>
            <if test="creator != null">
                #{creator,jdbcType=INTEGER},
            </if>
            now(),
            <if test="updator != null">
                #{updator,jdbcType=INTEGER},
            </if>

        </trim>
    </insert>

    <update id="updateCloudStorage" parameterType="com.malicn.server.domain.cloudStorage.CloudStorage">
        update yc_storage
        <set>
            company_name = #{companyName,jdbcType=VARCHAR},
            storage_name = #{storageName,jdbcType=VARCHAR},
            city_id = #{cityId,jdbcType=INTEGER},
            city_name = #{cityName,jdbcType=VARCHAR},
            storage_create_time = #{storageCreateTime,jdbcType=TIMESTAMP},
            storage_address = #{storageAddress,jdbcType=VARCHAR},
            billing_mode = #{billingMode,jdbcType=TINYINT},
            ref_price_min = #{refPriceMin,jdbcType=DECIMAL},
            ref_price_max = #{refPriceMax,jdbcType=DECIMAL},
            applicant = #{applicant,jdbcType=VARCHAR},
            applicant_contact = #{applicantContact,jdbcType=VARCHAR},
            applicant_con_tel = #{applicantConTel,jdbcType=VARCHAR},
            traffic_setting = #{trafficSetting,jdbcType=TINYINT},
            traffic_distance = #{trafficDistance,jdbcType=TINYINT},
            main_entr_width = #{mainEntrWidth,jdbcType=TINYINT},
            aisle_width = #{aisleWidth,jdbcType=TINYINT},
            park_wall = #{parkWall,jdbcType=TINYINT},
            is_access_con = #{isAccessCon,jdbcType=TINYINT},
            ad_price = #{adPrice,jdbcType=DECIMAL},
            security_term = #{securityTerm,jdbcType=VARCHAR},
            is_workspace = #{isWorkspace,jdbcType=TINYINT},
            is_frozen_market = #{isFrozenMarket,jdbcType=TINYINT},
            edifice_type = #{edificeType,jdbcType=TINYINT},
            storage_func = #{storageFunc,jdbcType=VARCHAR},
            storage_temp = #{storageTemp,jdbcType=TINYINT},
            cryogen_mode = #{cryogenMode,jdbcType=TINYINT},
            storage_capacity = #{storageCapacity,jdbcType=DECIMAL},
            con_area = #{conArea,jdbcType=DECIMAL},
            high_level = #{highLevel,jdbcType=TINYINT},
            storage_high = #{storageHigh,jdbcType=TINYINT},
            platform = #{platform,jdbcType=TINYINT},
            site_width = #{siteWidth,jdbcType=TINYINT},
            parking = #{parking,jdbcType=TINYINT},
            hole_count = #{holeCount,jdbcType=INTEGER},
            is_charge_pillar = #{isChargePillar,jdbcType=TINYINT},
            charge_count = #{chargeCount,jdbcType=INTEGER},
            is_fire_filing = #{isFireFiling,jdbcType=TINYINT},
            fire_system = #{fireSystem,jdbcType=VARCHAR},
            property_manage = #{propertyManage,jdbcType=TINYINT},
            storage_com_name = #{storageComName,jdbcType=VARCHAR},
            loading_fee = #{loadingFee,jdbcType=DECIMAL},
            scan_code_fee = #{scanCodeFee,jdbcType=DECIMAL},
            color_sep_fee = #{colorSepFee,jdbcType=DECIMAL},
            manage_fee = #{manageFee,jdbcType=VARCHAR},
            is_auth = #{isAuth,jdbcType=TINYINT},
            <if test="isDeleted != null">
                is_deleted = #{isDeleted,jdbcType=TINYINT},
            </if>
            <if test="updator != null">
                updator = #{updator,jdbcType=INTEGER}
            </if>
        </set>
        where id = #{id,jdbcType=BIGINT}
    </update>

    <update id="disableCloudStorage" parameterType="java.lang.Long">
    UPDATE yc_storage SET is_deleted=1 WHERE id=#{id}
  </update>

</mapper>