<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.malicn.server.dao.order.OrderTransferDao" >
  <resultMap id="OrderTransferMap" type="com.malicn.server.domain.order.OrderTransfer" extends="com.malicn.server.dao.order.OrderDao.OrderMap">
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="order_id" property="orderId" jdbcType="BIGINT" />
    <result column="trans_time" property="transTime" jdbcType="TIMESTAMP" />
    <result column="trans_name" property="transName" jdbcType="VARCHAR" />
    <result column="id_card_no" property="idCardNo" jdbcType="VARCHAR" />
    <result column="mobile" property="mobile" jdbcType="VARCHAR" />
    <result column="bank_name" property="bankName" jdbcType="VARCHAR" />
    <result column="bank_card_no" property="bankCardNo" jdbcType="VARCHAR" />
    <result column="bank_user_name" property="bankUserName" jdbcType="VARCHAR" />
    <result column="trade_amount" property="tradeAmount" jdbcType="DECIMAL" />
    <result column="pay_amount" property="payAmount" jdbcType="DECIMAL" />
    <result column="status" property="status" jdbcType="TINYINT" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
  </resultMap>

    <sql id="Base_Column_List">
        id, order_id, trans_time, trans_name, id_card_no, mobile, bank_name, bank_card_no,
        bank_user_name, trade_amount, pay_amount, remark, status, create_time, update_time
    </sql>
  <!-- 填写汇款信息 -->
  <insert id="saveOrderTransfer" parameterType="com.malicn.server.domain.order.OrderTransfer">
      INSERT INTO ml_order_transfer(order_id,trans_time,trans_name,id_card_no,mobile,bank_name,bank_card_no,bank_user_name,trade_amount,pay_amount,create_time,update_time,status)
      VALUES (#{orderId},#{transTime},#{transName},#{idCardNo},#{mobile},#{bankName},#{bankCardNo},#{bankUserName},#{tradeAmount},#{payAmount},now(),now(),0)
  </insert>

    <insert id="insertSelective" parameterType="com.malicn.server.domain.order.OrderTransfer" >
        insert into ml_order_transfer
        <trim prefix="(" suffix=")" suffixOverrides="," >
            <if test="id != null" >
                id,
            </if>
            <if test="orderId != null" >
                order_id,
            </if>
            <if test="transTime != null" >
                trans_time,
            </if>
            <if test="transName != null" >
                trans_name,
            </if>
            <if test="idCardNo != null" >
                id_card_no,
            </if>
            <if test="mobile != null" >
                mobile,
            </if>
            <if test="bankName != null" >
                bank_name,
            </if>
            <if test="bankCardNo != null" >
                bank_card_no,
            </if>
            <if test="bankUserName != null" >
                bank_user_name,
            </if>
            <if test="tradeAmount != null" >
                trade_amount,
            </if>
            <if test="payAmount != null" >
                pay_amount,
            </if>
            <if test="status != null" >
                status,
            </if>
            <if test="createTime != null" >
                create_time,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides="," >
            <if test="id != null" >
                #{id,jdbcType=BIGINT},
            </if>
            <if test="orderId != null" >
                #{orderId,jdbcType=BIGINT},
            </if>
            <if test="transTime != null" >
                #{transTime,jdbcType=DATE},
            </if>
            <if test="transName != null" >
                #{transName,jdbcType=VARCHAR},
            </if>
            <if test="idCardNo != null" >
                #{idCardNo,jdbcType=VARCHAR},
            </if>
            <if test="mobile != null" >
                #{mobile,jdbcType=VARCHAR},
            </if>
            <if test="bankName != null" >
                #{bankName,jdbcType=VARCHAR},
            </if>
            <if test="bankCardNo != null" >
                #{bankCardNo,jdbcType=VARCHAR},
            </if>
            <if test="bankUserName != null" >
                #{bankUserName,jdbcType=VARCHAR},
            </if>
            <if test="tradeAmount != null" >
                #{tradeAmount,jdbcType=DECIMAL},
            </if>
            <if test="payAmount != null" >
                #{payAmount,jdbcType=DECIMAL},
            </if>
            <if test="status != null" >
                #{status,jdbcType=TINYINT},
            </if>
            <if test="createTime != null" >
                #{createTime,jdbcType=TIMESTAMP},
            </if>
        </trim>
    </insert>

  <!-- 根据订单ID查询转账信息 -->
  <select id="getByOrderId" parameterType="java.lang.Long" resultMap="OrderTransferMap">
      SELECT id from ml_order_transfer where order_id=#{orderId}
  </select>
  <select id="getLatelyContact" resultMap="OrderTransferMap" parameterType="java.lang.Long">
      select a.trans_name,a.mobile,a.order_id,b.owner_id from ml_order_transfer a
      left join ml_order b
      on a.order_id = b.order_id
      where b.owner_id=#{userId} ORDER BY a.create_time
      LIMIT 1
  </select>

    <select id="getById" resultMap="OrderTransferMap">
        SELECT <include refid="Base_Column_List" /> from ml_order_transfer where id=#{id}
    </select>

    <select id="selectByPrimaryKeyAllList" resultMap="OrderTransferMap">
    SELECT <include refid="Base_Column_List" /> from ml_order_transfer
    where 1=1
    <if test="mobile !=null and mobile !=''">
        AND mobile like  concat('%',#{mobile},'%')
    </if>
    <if test="transName !=null and transName !=''">
        AND trans_name like  concat('%',#{transName},'%')
    </if>
    <if test="orderIdString !=null and orderIdString !=''">
        AND  order_id like  concat('%',#{orderIdString},'%')
    </if>
    <if test="statusString !=null and statusString !=''">
            AND  status =#{statusString}
    </if>
        ORDER BY create_time asc
    </select>

    <update id="updateStatus">
    UPDATE ml_order_transfer
        <set>
        status=#{status},
     <if test="remark !=null and remark!=''">
           remark=#{remark},
     </if>
     <if test="payAmount !=null and payAmount!=''">
           pay_amount=#{payAmount}
     </if>
    </set>
     where id=#{id}
    </update>

</mapper>